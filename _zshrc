HISTFILE=~/.zsh_history
SAVEHIST=1000
HISTSIZE=1000
setopt appendhistory
# zsh のオススメ設定
setopt interactivecomments  # ハッシュをコメントとして無視する (bashのように)
setopt extended_glob        # 拡張グロブを有効にする
setopt glob_dots            # 隠しファイルをグロブに含める (bashのように)
setopt no_beep              # うるさいビープ音を止める

# Initialize brew in current session (handles architecture automatically)
# Bootstrap brew from install location
for brew_path in /opt/homebrew/bin/brew /usr/local/bin/brew /home/linuxbrew/.linuxbrew/bin/brew; do
    if [[ -x "$brew_path" ]]; then
        eval "$($brew_path shellenv)"
        break
    fi
done

# Initialize direnv if available
if command -v direnv >/dev/null 2>&1; then
    eval "$(direnv hook zsh)"
fi

### Added by Zinit's installer
if [[ ! -f $HOME/.zinit/bin/zinit.zsh ]]; then
    print -P "%F{33}▓▒░ %F{220}Installing %F{33}DHARMA%F{220} Initiative Plugin Manager (%F{33}zdharma/zinit%F{220})…%f"
    command mkdir -p "$HOME/.zinit" && command chmod g-rwX "$HOME/.zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.zinit/bin" && \
        print -P "%F{33}▓▒░ %F{34}Installation successful.%f%b" || \
        print -P "%F{160}▓▒░ The clone has failed.%f%b"
fi
if [[ -f "$HOME/.zinit/bin/zinit.zsh" ]]; then
    source "$HOME/.zinit/bin/zinit.zsh"
    autoload -Uz _zinit
    (( ${+_comps} )) && _comps[zinit]=_zinit
    # Load a few important annexes, without Turbo
    # (this is currently required for annexes)
    zinit light-mode for \
        zdharma-continuum/z-a-rust \
        zdharma-continuum/z-a-as-monitor \
        zdharma-continuum/z-a-patch-dl \
        zdharma-continuum/z-a-bin-gem-node
    ### End of Zinit's installer chunk
    # Two regular plugins loaded without tracking.
    zinit light zsh-users/zsh-autosuggestions
    zinit light zdharma-continuum/fast-syntax-highlighting
    zinit ice depth=1; zinit light romkatv/powerlevel10k
else
    print -P "%F{160}▓▒░ Zinit not found. Run setup script or install manually.%f%b"
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true

# シェル上で日本語化けるの対策。 # sshでlinuxリモートで化ける時は、iterm2 から locale variable を送信しないように変更
# export LANG=ja_JP.UTF-8
# Easier to handle ssh etc
export LANG=en_US.UTF-8

# coatools @taiyodayo
if [ -f ~/.mailab/coatools/coatools.sh ]; then
    source ~/.mailab/coatools/coatools.sh
fi

# mai研究室用スクリプト
export docker_host=$(hostname)

# マシン別の設定ファイルをソース
if [ -f ~/.zlocal ]; then
  source ~/.zlocal
fi

## Colorize the ls output (GNU ls vs BSD ls)
if [[ "$(uname -s)" == "Darwin" ]]; then
    alias ls='ls -G'
else
    alias ls='ls --color=auto'
fi

# 実行ユーザの uid/gid でコンテナを実行
export local_uid=$(id -u)
export local_gid=$(id -g)
export docker_host=$(hostname)
export MAI_DEBUG="rstudio_gui"

git config --global user.name "taiyo@$(hostname) default"
git config --global user.email "taiyodayo@gmail.com"

# "tmux not working with git when ssh -A" issue. Only modify SSH_AUTH_SOCK when inside tmux
if [ -n "$TMUX" ] && [ -S "$SSH_AUTH_SOCK" ]; then
    # Only create/use symlink for tmux sessions
    mkdir -p ~/.ssh
    ln -sf "$SSH_AUTH_SOCK" ~/.ssh/ssh_auth_sock
    export SSH_AUTH_SOCK=~/.ssh/ssh_auth_sock
fi
